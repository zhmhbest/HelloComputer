
### 总线概念

**总线特性**：机械特性、电气特性、功能特性、时间特性

#### 总线分类

**按传输方式分为**：串行、并行

**按总线功能分为**：片内、系统（数据、地址、控制）、通信

**按时序分为**：同步、异步

#### 总线性能指标

**总线传输周期**：一次总线操作所需的时间，包括**申请**、**寻址**、**传输**、**结束**等阶段。

**总线时钟周期**：机器的时钟周期。

**总线工作频率**：总线传输周期的倒数。

**总线时钟频率**：总线时钟周期的倒数。

**总线宽度**：同时能传输的数据位数，通常指数据总线的根数。

**总线带宽**：数据传输率，单位时间总线上可传输数据的位数。

**总线复用**：一种信号线在不同时间传输不同的信息。

**信号线数**：地址总线、数据总线、控制总线等3种总线的总和。

#### 总线标准

|           |   分类   | 串行 | 数据线 | 最大速度 | 补充              |
| --------: | :------: | :--: | :----- | :------- | :---------------- |
|       ISA | 系统总线 |  ×   | 8, 16  | 16MB/s   | 淘汰              |
|      EISA | 系统总线 |  ×   | 32     | 32MB/s   | 淘汰              |
|           |          |      |        |          |                   |
|   **PCI** | 局部总线 |  ×   | 32, 64 | 528MB/s  | 即插即用          |
|       AGP | 局部总线 |  ×   | -      | 2.1GB/s  | 图形加速          |
| **PCI-E** | 局部总线 |  √   | -      | 10+GB/s  | 点对点、全双工    |
|      VESA | 局部总线 |      | 32     | 132MB/s  | 高速视频传送      |
|           |          |      |        |          |                   |
|**RS-232C** | 设备总线 |  √   | 9      | 20Kbps   | 串口              |
|   IDE/ATA | 设备总线 |  ×   | 40     | 133MB/s  |                   |
|      SATA | 设备总线 |  √   | 15+7   | 750MB/s  | 串行ATA           |
|      SCSI | 设备总线 |  ×   | -      | 320MB/s  |                   |
|       SAS | 设备总线 |  √   | -      | 768MB/s  | 串行SCSI          |
|  FireWire | 设备总线 |  √   | -      | 400MB/s  |                   |
|   **USB** | 设备总线 |  √   | -      |          | 热插拔            |
|           |          |      |        |          |                   |
|       VGA | 视频总线 |      |        |          | 模拟信号          |
|       DVI | 视频总线 |      |        |          | 模拟信号/数字信号 |
|        DP | 视频总线 |      |        |          | 数字信号          |
|      HDMI | 视频总线 |      |        |          | 数字信号          |

### 总线结构

![bus_struct1](images/bus/bus_struct1.png)

![bus_struct2](images/bus/bus_struct2.png)

- 单总线结构
- 双总线结构：低速I/O从单总线上分离
- 三总线结构：DMA用于高速I/O与主存直接交换信息
- 四总线结构：CPU总线、系统总线、高速总线、扩充总线

### 总线控制

#### 总线仲裁

**主设备**：获得总线控制权的设备。

**从设备**：被主设备访问的设备。

![arbitration](images/bus/arbitration.png)

- BG：总线允许
- BR：总线请求
- BS：总线忙

|                    | 控制线数                                                     | 优点                                   | 缺点                             |
| -----------------: | :----------------------------------------------------------- | :------------------------------------- | :------------------------------- |
|       **链式查询** | 总线请求：$1$<br>总线允许：$1$<br>总先忙：$1$                | 优先级固定；<br>结构简单；<br>容易扩充 | 对电路故障敏感；<br>优先级不灵活 |
| **计数器定时查询** | 总线请求：$1$<br>总线允许：$\lceil{log_2{n}}\rceil$<br>总先忙：$1$ | 优先级灵活                             | 控制线多；<br>控制相对复杂       |
|       **独立请求** | 总线请求：$n$<br>总线允许：$n$<br>总先忙：$1$                | 响应速度快；<br>优先级灵活             | 控制线多；<br>控制复杂           |

#### 通信控制

|                | 说明                                                         |
| -------------: | ------------------------------------------------------------ |
|   **同步定时** | 在一个总线周期中，发送方和接收方可进行一次数据传送<br>**优点**：速度快<br>**缺点**：主从强制同步 |
|   **异步定时** | 分为**不互锁**、**半互锁**、**全互锁**三种<br>**优点**：总线周期长度可变<br>**缺点**：控制复杂、速度较慢 |
| **半同步通信** | 统一时钟的基础上，增加等待响应信号。                         |
| **分离式通信** | 总线传输周期分为主模块占用和从模块占用                       |

**同步定时**：

![synchronization](images/bus/synchronization.png)

**异步定时**：

![asynchronous](images/bus/asynchronous.png)

- **不互锁**：主设备请求后不等待从设备**回答信号**，一段时间后便自动撤销**请求信号**。
- **半互锁**：主设备请求后等待从设备**回答信号**；从设备不等待获知主设备**请求信号**已撤销，一段时间后便自动撤销**回答信号**。
- **全互锁**：主设备请求后等待从设备**回答信号**；从设备回答后，等待主设备**请求信号**撤销再撤销**回答信号**。
