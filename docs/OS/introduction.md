
### 操作系统的定义

- 操作系统是**系统软件**（软件分为系统软件和应用软件）；
- 操作系统是**用户与计算机硬件系统之间的接口（包括用户接口和程序接口）**，隐藏了对硬件操作的细节；
- 操作系统是**资源（处理器、存储器、IO设备、文件）的管理者**，实现了对计算机资源的抽象。

### 操作系统发展

|           发展阶段 | 存在问题或特点     | 特性                                                         |
| -----------------: | ------------------ | ------------------------------------------------------------ |
|       手工操作阶段 | 人机速度矛盾       |                                                              |
| **单道批处理系统** | 资源利用率低       | 自动性、顺序性、单道性                                       |
| **多道批处理系统** | 没有人机交互       | 资源利用率高、系统吞吐量大、平均周转时间长、无交互能力       |
|         **分时OS** | 没有优先级         | 多路/同时性（主机同时连接多个终端）<br>独立性（用户终端彼此不干扰）<br>及时性（及时响应用户请求）<br>交互性 |
|       **硬实时OS** | 严格规定时间内完成 | 多路性、独立性、及时性、交互性、可靠性                       |
|       **软实时OS** | 可偶尔违反时间规定 | 多路性、独立性、及时性、交互性、可靠性                       |
|       微机操作系统 |                    | 单用户单任务、单用户多任务、多用户多任务                     |
|     分布式操作系统 |                    |                                                              |

### 操作系统特征

- 并发：宏观上同时，微观上交替。
- 共享：资源贡献，共享方式——互斥共享、同时共享。
- 虚拟：物理实体变为若干逻辑对应物，实现技术——空分复用、时分复用。
- 异步：由并发性产生了异步性。

### 操作系统运行机制

|            状态 | PSW  |   程序   | 指令                     |
| --------------: | :--: | :------: | :----------------------- |
| **核心态/管态** |  1   | 内核程序 | 全部指令（特权、非特权） |
| **用户态/目态** |  0   | 应用程序 | 非特权指令               |

```mermaid
graph LR
    U([用户态]); S([核心态]);
    U--"中断（唯一途径）"--->S;
    S--"通过特权指令设置PSW=0"--->U;
```

用户态可以发生：系统调用、中断（外部中断、缺页等），但不能发生进程切换。

#### 系统调用

系统调用需要执行一些特权指令，故需要在核心态下进行。

系统调用是操作系统与程序之间的接口。

**系统调用和库函数**：系统调用需要使用汇编语言调用。高级语言库函数可以是对系统调用的封装（即**库函数不一定使用到系统调用**）。

**操作系统主要功能（系统调用功能）**：处理机管理（进程控制、进程同步、进程通信、进程调度）、存储器管理/内存管理、设备管理、文件管理。

#### 中断分类

- 内中断（异常、例外、陷入）：来自CPU内部
  - 自愿中断：指令中断（如trap）
  - 强迫中断：硬件故障（如缺页）、软件中止（如除0）
- 外中断（狭义的中断）：来自CPU外部
  - 外设请求
  - 人工干预

#### 外中断处理过程

- 每个指令完成后，检查是否有外部中断信号；
- 若检测到中断信号，则保护被中断进程的CPU环境（关键寄存器内容）；
- 根据中断信号类型转入相应的中断处理程序；
- 恢复被中断进程进程的CPU环境，并退出中断。

### 操作系统体系结构

操作系统是层次且模块化的。

**分类**：无结构、模块化结构、分层式结构、微内核结构（小内核、C/S模式、机制与策略分离、面向对象技术）。

**原语**：由若干条指令组成的程序段，用来实现某个特定功能，**在执行过程中不可被中断**，由**关中断**和**开中断**来实现。

@import "tables/layer.html"

|   内核类型 | 优点               | 缺点                             |
| ---------: | :----------------- | :------------------------------- |
| **大内核** | 高性能             | 内核代码庞大，结构混乱，难以维护 |
| **微内核** | 结构清晰，方便维护 | 性能低                           |
