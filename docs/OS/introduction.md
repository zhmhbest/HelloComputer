
软件分为系统软件和应用软件，**操作系统是系统软件**。

### 操作系统特征

- 并发：宏观上同时，微观上交替
- 共享：资源贡献
  - 互斥共享
  - 同时共享
- 虚拟：物理实体变为若干逻辑对应物
  - 空分复用
  - 时分复用
- 异步：由并发性产生了异步性

### 操作系统发展

- 手工操作阶段：人机速度矛盾
- 批处理阶段
  - 单道：资源利用率低
  - 多道（操作系统开始出现）：没有人机交互功能
- 分时操作系统：任务没有优先级
- 实时操作系统：能处理紧急任务
  - 硬实时：必须在严格规定时间内完成处理
  - 软实时：能接受偶尔违反时间规定
- 其它操作系统
  - 网络操作系统
  - 分布式操作系统
  - 个人计算机操作系统

### 操作系统运行机制

| 指令       | 特权指令                | 非特权指令              |
| ---------- | ----------------------- | ----------------------- |
| 处理器状态 | 核心态（管态，$PSW=1$） | 用户态（目态，$PSW=0$） |
| 程序       | 内核程序                | 应用程序                |

- 用户态→核心态：中断，且是唯一途径。
- 核心态→用户态：特权指令设置$PSW=0$

### 操作系统体系结构

@import "tables/layer.html"

|      |              大内核              |       微内核       |
| ---: | :------------------------------: | :----------------: |
| 优点 |              高性能              | 结构清晰，方便维护 |
| 缺点 | 内核代码庞大，结构混乱，难以维护 |       性能低       |

#### 原语

由若干条指令组成的程序段，用来实现某个特定功能，**在执行过程中不可被中断**，由**关中断**和**开中断**来实现。

### 中断

- 内中断（异常、例外、陷入）：来自CPU内部
  - 自愿中断：指令中断（如trap）
  - 强迫中断：硬件故障（如缺页）、软件中止（如除0）
- 外中断（狭义的中断）：来自CPU外部
  - 外设请求
  - 人工干预

#### 外中断处理过程

- 每个指令完成后，检查是否有外部中断信号；
- 若检测到中断信号，则保护被中断进程的CPU环境；
- 根据中断信号类型转入相应的中断处理程序；
- 恢复被中断进程进程的CPU环境，并退出中断。

### 系统调用

系统调用需要执行一些特权指令，故需要在核心态下进行。

- 设备管理
- 文件管理
- 进程管理
- 进程通信
- 内存管理

#### 系统调用和库函数

系统调用需要使用汇编语言调用。高级语言库函数可以是对系统调用的封装（注意库函数不一定使用到系统调用）。
